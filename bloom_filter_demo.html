<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloom Filter Visualization</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px; }
        h1 { color: #673ab7; }
        
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 900px; }
        
        .controls { display: flex; gap: 10px; margin-bottom: 30px; justify-content: center; }
        input { padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem; width: 200px; }
        button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: transform 0.1s; }
        button:active { transform: scale(0.95); }
        .btn-add { background: #28a745; color: white; }
        .btn-check { background: #007bff; color: white; }
        .btn-reset { background: #6c757d; color: white; }

        .bit-array-container { margin: 40px 0; overflow-x: auto; padding-bottom: 10px; }
        .bit-array { display: flex; gap: 4px; justify-content: center; min-width: max-content; }
        .bit { 
            width: 30px; height: 40px; border: 1px solid #ccc; border-radius: 4px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 0.8rem; background: #f8f9fa; transition: all 0.3s; position: relative;
        }
        .bit.active { background: #4caf50; color: white; border-color: #388e3c; font-weight: bold; }
        .bit-index { font-size: 0.6rem; color: #999; margin-top: 2px; }
        .bit-val { font-size: 1rem; }
        
        .bit.highlight { box-shadow: 0 0 10px #ff9800; border-color: #ff9800; transform: scale(1.1); z-index: 10; }

        .hash-functions { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .hash-func { 
            background: #e3f2fd; padding: 15px; border-radius: 8px; border: 2px solid #90caf9; 
            width: 200px; text-align: center; position: relative;
        }
        .hash-val { font-size: 1.5rem; font-weight: bold; color: #1565c0; margin-top: 5px; min-height: 35px; }

        .log-area { 
            background: #212121; color: #00e676; padding: 15px; border-radius: 8px; 
            font-family: monospace; height: 150px; overflow-y: auto; margin-top: 20px; 
        }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 2px; }
        .log-entry.error { color: #ff5252; }
        .log-entry.warn { color: #ffab40; }

        .explanation {
            margin-top: 20px; padding: 15px; background: #fff3e0; border-left: 5px solid #ff9800; border-radius: 4px; color: #5d4037;
        }

        /* Animation Arrows */
        .arrow {
            position: absolute; width: 2px; background: #ff9800; transform-origin: 0 0; pointer-events: none; z-index: 5;
        }

    </style>
</head>
<body>
    <h1>Bloom Filter Visualization</h1>
    
    <div class="container">
        <div class="explanation">
            <strong>Core Concept:</strong> A Bloom Filter is a probabilistic data structure. 
            It tells you if an element is <strong>"Possibly in set"</strong> or <strong>"Definitely not in set"</strong>.
            It never gives false negatives, but can give false positives.
        </div>

        <div class="controls">
            <input type="text" id="input-val" placeholder="Enter string (e.g. 'Apple')" onkeypress="if(event.key==='Enter') addVal()">
            <button class="btn-add" onclick="addVal()">Add to Set</button>
            <button class="btn-check" onclick="checkVal()">Check Existence</button>
            <button class="btn-reset" onclick="resetFilter()">Reset</button>
        </div>

        <div class="hash-functions">
            <div class="hash-func">
                <div>Hash Function 1</div>
                <div class="hash-val" id="h1-val">-</div>
            </div>
            <div class="hash-func">
                <div>Hash Function 2</div>
                <div class="hash-val" id="h2-val">-</div>
            </div>
            <div class="hash-func">
                <div>Hash Function 3</div>
                <div class="hash-val" id="h3-val">-</div>
            </div>
        </div>

        <div class="bit-array-container">
            <div class="bit-array" id="bit-array">
                <!-- Bits generated by JS -->
            </div>
        </div>

        <div class="log-area" id="log">
            <div class="log-entry">> Ready. Array Size: 30 bits. 3 Hash Functions.</div>
        </div>
    </div>

    <script>
        const ARRAY_SIZE = 30;
        const bitArray = new Array(ARRAY_SIZE).fill(0);
        
        // Initialize UI
        const bitContainer = document.getElementById('bit-array');
        for(let i=0; i<ARRAY_SIZE; i++) {
            const div = document.createElement('div');
            div.className = 'bit';
            div.id = `bit-${i}`;
            div.innerHTML = `<span class="bit-val">0</span><span class="bit-index">${i}</span>`;
            bitContainer.appendChild(div);
        }

        // Simple Hash Functions for demo purposes
        function hash1(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = (hash << 5) - hash + str.charCodeAt(i);
                hash |= 0; 
            }
            return Math.abs(hash) % ARRAY_SIZE;
        }

        function hash2(str) {
            let hash = 5381;
            for (let i = 0; i < str.length; i++) {
                hash = ((hash << 5) + hash) + str.charCodeAt(i); 
            }
            return Math.abs(hash) % ARRAY_SIZE;
        }

        function hash3(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = (hash + str.charCodeAt(i) * (i + 1));
            }
            return Math.abs(hash) % ARRAY_SIZE;
        }

        async function addVal() {
            const input = document.getElementById('input-val');
            const val = input.value.trim();
            if(!val) return;

            log(`Adding "${val}"...`);
            
            const h1 = hash1(val);
            const h2 = hash2(val);
            const h3 = hash3(val);

            await visualizeHash(1, h1);
            await visualizeHash(2, h2);
            await visualizeHash(3, h3);

            // Set bits
            setBit(h1);
            setBit(h2);
            setBit(h3);

            log(`> Added "${val}". Bits [${h1}, ${h2}, ${h3}] set to 1.`);
            input.value = '';
        }

        async function checkVal() {
            const input = document.getElementById('input-val');
            const val = input.value.trim();
            if(!val) return;

            log(`Checking "${val}"...`);

            const h1 = hash1(val);
            const h2 = hash2(val);
            const h3 = hash3(val);

            await visualizeHash(1, h1);
            const b1 = bitArray[h1];
            highlightBit(h1, b1 === 1 ? 'good' : 'bad');
            if(b1 === 0) {
                log(`> Bit ${h1} is 0. Result: DEFINITELY NOT in set.`, 'error');
                return;
            }

            await visualizeHash(2, h2);
            const b2 = bitArray[h2];
            highlightBit(h2, b2 === 1 ? 'good' : 'bad');
            if(b2 === 0) {
                log(`> Bit ${h2} is 0. Result: DEFINITELY NOT in set.`, 'error');
                return;
            }

            await visualizeHash(3, h3);
            const b3 = bitArray[h3];
            highlightBit(h3, b3 === 1 ? 'good' : 'bad');
            if(b3 === 0) {
                log(`> Bit ${h3} is 0. Result: DEFINITELY NOT in set.`, 'error');
                return;
            }

            log(`> All bits [${h1}, ${h2}, ${h3}] are 1. Result: POSSIBLY in set.`, 'warn');
        }

        function setBit(index) {
            bitArray[index] = 1;
            const el = document.getElementById(`bit-${index}`);
            el.classList.add('active');
            el.querySelector('.bit-val').innerText = '1';
            highlightBit(index, 'set');
        }

        function highlightBit(index, type) {
            const el = document.getElementById(`bit-${index}`);
            el.classList.add('highlight');
            if(type === 'bad') el.style.borderColor = 'red';
            setTimeout(() => {
                el.classList.remove('highlight');
                el.style.borderColor = '';
            }, 1000);
        }

        async function visualizeHash(funcNum, val) {
            document.getElementById(`h${funcNum}-val`).innerText = val;
            // Simple delay for visualization
            await new Promise(r => setTimeout(r, 300));
        }

        function log(msg, type='') {
            const div = document.createElement('div');
            div.className = `log-entry ${type}`;
            div.innerText = msg;
            const container = document.getElementById('log');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function resetFilter() {
            bitArray.fill(0);
            document.querySelectorAll('.bit').forEach(b => {
                b.classList.remove('active');
                b.querySelector('.bit-val').innerText = '0';
            });
            document.getElementById('h1-val').innerText = '-';
            document.getElementById('h2-val').innerText = '-';
            document.getElementById('h3-val').innerText = '-';
            document.getElementById('log').innerHTML = '<div class="log-entry">> Reset complete.</div>';
        }
    </script>
</body>
</html>